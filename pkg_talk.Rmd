---
title: "Sydney Coding Club - Building R Package"
subtitle: "https://kevinwang09.github.io/tutor_demo/"
author: '[Kevin Y. X. Wang](https://kevinwang09.github.io/)'
date: "`r paste0('Initiated on 2019 Feb 17, compiled on ', format(Sys.time(), '%Y %b %d'))`"
output:
  xaringan::moon_reader:
    css: ["default", "assets/sydney-fonts.css", "assets/sydney.css"]
    self_contained: false # if true, fonts will be stored locally
    seal: true # show a title slide with YAML information
    includes:
      in_header: "assets/mathjax-equation-numbers.html"
    nature:
      beforeInit: ["assets/remark-zoom.js", "https://platform.twitter.com/widgets.js"]
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: true
      ratio: '16:9' # alternatives '16:9' or '4:3' or others e.g. 13:9
      navigation:
        scroll: false # disable slide transitions by scrolling
---
```{r, echo = FALSE, message=FALSE}
knitr::knit_hooks$set(error = function(x, options) {
  paste0("<pre style=\"color: red;\"><code>", x, "</code></pre>")
})
library(tidyverse)
```

class: segue

### Acknowledgement

+ Credits go to Garth, Dario and Mark on building good coding practices.

+ I do not believe in coding via talking, you should struggle on your own to find a package building pipeline that suits your own style.

---

## Some resources

+ Read http://r-pkgs.had.co.nz/
+ StackExchange
+ `tidyverse` packages on GitHub
+ GitHub issues pages
+ Bioconductor style guide

---

## Building a package is more than just coding.

+ Designs, organisations, dependencies, testing and debugging. 

+ Don’t do a package unless you are sure of the ROI of your time.

+ Some packages that I worked on:
  
    - SmokyScotch: 55 commits
    - mcvis: 47 commits, 2 branches, 2 remotes
    - APES: 72 commits, 2 branches
    - scMerge: 152 commits, 4 branches, 2 remotes

+ Almost all of these packages broke in a major way a few times. Either because my poor understanding of GitHub or because someone else's fault. 

+ And it could be quite frustrating when Garth is drinking wine at a nice Armidale bar and I had a bash my keyboard in frustration. 

---
## Packages of a different standards

Loosely speaking, a `R` package is a glorified folder with a bunch of scripts*.


  1. A `laptop` package
    - Write your code using `roxygen2`.
  1. A `GitHub` package
    - Make a GitHub repository and push.
  1. A CRAN package
    - `devtools::check()`
  1. A Bioconductor package
    - `BiocCheck::BiocCheck()`

  
.footnote[*This is great if you want to cheat-install a package that you are not meant to.]

---

## Manage your package files `devtools` and `roxygen2`

```{r}
.libPaths() %>% list.files() %>% head()
.libPaths() %>% paste0("/scMerge") %>% list.files()
```

+ `devtools` and `roxygen2` are packages that manage these files and folders for you.
    - `roxygen2`: managing the namespaces and documents
    - `devtools`: build
    
---

## Making a CRAN package

+ `devtools::build()` a package is cheap
+ `devtools::check()` a package is a much higher standard
+ Everyone must pass this check before being put on CRAN or BioC.

    - Error: the worst of all. [dum dum dum]
    - Warning: less severe, but also prevents pass. 
    - Note: You should check these, but no worries, she’ll be right [Australian accent].

+ Hadley (and thus, I) recommends `devtools::check()` instead of `R CMD Check`

+ Also consider `devtools::release_check()`.

---

Demo: `mcvis` - friday branch

---

## Making a Bioconductor package

+ Bioconductor has a greater focus on documentations, examples and vignettes, reproducibility and coding styles

+ Bioconductor uses GitHub + their own version of git + docker + virtual machine checker + human reviewer

+ Development must be done with respect to the **development branch** of Bioconductor AND the **unreleased development version** of `R`

+ Bioconductor has a much higher standard of accepting a package than CRAN

+ `BiocCheck::BiocCheck()` checks for
  - if maintainer is registered with BioC
  - coding documentations (e.g. `\dontrun{}` is forbidden)
  - coding style (e.g. recommended function length is less than 50 lines)
  
--- 

## Bioconductor fun stories

---

## Other useful packages 


--- 

## `testthat`

+ A "test" folder is set up with a collection of test scripts. So that you can test if the outputs are genuinely matching with your pre-computed results. 

---


